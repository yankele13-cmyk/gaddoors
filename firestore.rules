rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper to check if user is admin
    // For now, valid authentication is enough for the Admin Panel
    
    // --- COLLECTIONS ---

    // Products: Public Read, Admin Write
    match /products/{productId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // Installations: Public Read, Admin Write
    match /installations/{installationId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // Leads (CRM): Admin Only
    match /leads/{leadId} {
      allow read, write: if isAuthenticated();
    }
    
    // Messages (Contact Form): Public Create, Admin Read/Update
    match /messages/{messageId} {
      allow create: if true;
      allow read, update, delete: if isAuthenticated();
    }

    // Appointments (Calendar): Admin Only
    match /appointments/{apptId} {
      allow read, write: if isAuthenticated();
    }

    // Quotes: Admin Only
    match /quotes/{quoteId} {
      allow read, write: if isAuthenticated();
    }

    // Orders: Admin Only
    match /orders/{orderId} {
      allow read, write: if isAuthenticated();
    }

    // Invoices: Admin Only
    match /invoices/{invoiceId} {
      allow read, write: if isAuthenticated();
    }
    
    // Installers (Ops): Admin Only
    match /installers/{installerId} {
      allow read, write: if isAuthenticated();
    }
  }
}
